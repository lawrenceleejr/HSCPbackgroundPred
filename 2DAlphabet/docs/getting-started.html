<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>2DAlphabet: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">2DAlphabet
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">Background modeling framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('getting-started.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#install">Installation</a></li>
<li class="level1"><a href="#config">JSON Configuration Files</a><ul><li class="level2"><a href="#config-global">`GLOBAL`</a></li>
<li class="level2"><a href="#config-options">`OPTIONS`</a></li>
<li class="level2"><a href="#config-process">`PROCESS`</a></li>
<li class="level2"><a href="#config-binning">`BINNING`</a></li>
<li class="level2"><a href="#config-fit">`FIT`</a></li>
<li class="level2"><a href="#config-syst">`SYSTEMATIC`</a><ul><li class="level3"><a href="#config-syst-asym">Asymmetric, log-normal</a></li>
<li class="level3"><a href="#config-syst-shape2">Shape based uncertainty, in different file as nominal histogram</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#python">Python Interface</a><ul><li class="level2"><a href="#python-twoD">Constructing TwoDAlphabet</a></li>
<li class="level2"><a href="#python-parametric">Defining Parametric Shapes</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>{html}</p>
<h1><a class="anchor" id="install"></a>
Installation</h1>
<p>2D Alphabet can only be used in a CMSSW environment. The Higgs Analysis Combine Tool must be installed. Please follow the instructions below to checkout a 2D Alphabet-friendly version of Combine. These instructions are based off of the <a href="http://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/">Combine documentation</a> for 102X setup. Please cross-check the instructions here with the official instructions. The only difference should be in the cloned repository and lack of branch change. Note also that the CMSSW release is different from the release recommended by the Combine tool documentation in order to maintain compatibility with Fermilab's LPC changing to SL7 by September 1st, 2020.</p>
<p>For <code>csh</code>: </p><div class="fragment"><div class="line">set SCRAM_ARCH=slc7_amd64_gcc700</div><div class="line">cmsrel CMSSW_10_6_14</div><div class="line">cd CMSSW_10_6_14/src</div><div class="line">cmsenv</div><div class="line">git clone https://github.com/lcorcodilos/2DAlphabet.git</div><div class="line">git clone https://github.com/lcorcodilos/HiggsAnalysis-CombinedLimit.git HiggsAnalysis/CombinedLimit</div><div class="line">bash &lt;(curl -s https://raw.githubusercontent.com/lcorcodilos/CombineHarvester/master/CombineTools/scripts/sparse-checkout-ssh.sh)</div><div class="line">scram b clean; scram b -j 10</div><div class="line">cmsenv</div></div><!-- fragment --><p>For <code>bash</code>: </p><div class="fragment"><div class="line">export SCRAM_ARCH=slc7_amd64_gcc700</div><div class="line">cmsrel CMSSW_10_6_14</div><div class="line">cd CMSSW_10_6_14/src</div><div class="line">cmsenv</div><div class="line">git clone https://github.com/lcorcodilos/2DAlphabet.git</div><div class="line">git clone https://github.com/lcorcodilos/HiggsAnalysis-CombinedLimit.git HiggsAnalysis/CombinedLimit/</div><div class="line">curl -s https://raw.githubusercontent.com/lcorcodilos/CombineHarvester/master/CombineTools/scripts/sparse-checkout-ssh.sh | bash</div><div class="line">scram b clean; scram b -j 10</div><div class="line">cmsenv</div></div><!-- fragment --><p>Run <code>combine --help</code> and check it returns the help menu to confirm you've successfully setup combine.</p>
<p>Try to call RooParametricHist2D in interactive python if you're feeling uneasy and to ensure everything is working.</p>
<div class="fragment"><div class="line">import ROOT</div><div class="line">r = RooParametricHist2D()</div></div><!-- fragment --><h1><a class="anchor" id="config"></a>
JSON Configuration Files</h1>
<p>The goal of the JSON is to have an easily understandable and configurable input that allows the 2D Alphabet software to read and organize analysis files and histograms to its liking while also giving the user the ability to easily configure values like bin sizes and ranges without lots of command line options. This means that while the user is encouraged to add what they need, there are some keys and values that must stay the same. These static strings are always in capital letters to make them easy to distinguish. The six static sections are described below.</p>
<h2><a class="anchor" id="config-global"></a>
`GLOBAL`</h2>
<p>This section is designed to help users with large configuration file names by allowing them to create JSON-wide variables. For example, if all of your files are located in <code>/long/path/to/my/files/</code>, you can store this string in the GLOBAL dictionary with a custom key (let's say <code>path</code>). Now instead of having to write the full directory path for every process and systematic, the user can just write <code>path</code>. This simplifies the JSON and also has the standard advantages of using variables over several instances of the same object.</p>
<p>This functionality works by searching all strings in the JSON for instances of each key in <code>GLOBAL</code> and replacing the key with its corresponding dictionary value. Note that it does not work for booleans or integers/floats.</p>
<p>The user must be careful they don't accidentally use strings in the JSON that are identical to keys in <code>GLOBAL</code> so accidental substitutions don't happen. This means keys in <code>GLOBAL</code> should be at least partially descriptive (single character keys would be a bad idea).</p>
<h2><a class="anchor" id="config-options"></a>
`OPTIONS`</h2>
<p>This section is dedicated to providing per-config options to 2D Alphabet. Unless noted, these options only affect <code>run_MLfit.py</code> since that tool is responsible for building the model performing the initial fit that is read by the other <code>run_*.py</code> tools.</p>
<p>Required among these options the <code>name</code> for the configuration file so that the pass-fail pair can be uniquely identified among those provided to 2D Alphabet. Truly optional options include those for blinding, plotting, and changing fit functionality. The most common possible options are described in detail below.</p>
<ul>
<li><b>name</b> (<code>string</code>, default=<code>None</code>): Required. Provides a unique name to the configuration file.</li>
<li><b>tag</b> (<code>string</code>, default=<code>None</code>): Provides a tag to group configuration files and create an output directory of the same name ("project directory"). Overriden by the <code>-q/--tag</code> command-line option to <code>run_MLfit.py</code> which will set the provided tag to all configuration files.</li>
<li><b>year</b> (<code>int</code>, default=1): Default <code>1</code> indicates this is full Run II. Other options are <code>16</code>, <code>17</code>, and <code>18</code>. This option determines what luminosity will be included in the plots and helps group configuration files when plotting the full Run II together (when years have been fit separately).</li>
<li><b>blindedFit</b> (<code>bool</code>, default=<code>true</code>): Blinds the fit to the signal region defined by <code>SIGSTART</code> and <code>SIGEND</code>.</li>
<li><b>blindedPlots</b> (<code>bool</code>, default=<code>true</code>): Blind the plots to the signal region defined by <code>SIGSTART</code> and <code>SIGEND</code>.</li>
<li><b>plotUncerts</b> (<code>bool</code>, default=<code>true</code>): Turns on plotting of the <code>X</code> and <code>Y</code> projections of the shape uncertainty templates provided (after rebinning). Useful for comparing nominal templates with uncertainty variations.</li>
<li><b>prerun</b> (<code>bool</code>, default=<code>true</code>): Runs the ML fit for this configuration file by itself and feeds the resulting transfer function parameters into the simultaneous fit with the other configuration files. This option can be effective if the fit cannot converge to a minimum because of too few steps.</li>
<li><b>plotPrefitSigInFitB</b> (<code>bool</code>, default=<code>false</code>): By default, the background-only fit result plots will include no signal since <code>r = 0</code>. This option set to <code>true</code> will plot the pre-fit signal (normalized to <code>r = 1</code>) instead. The s+b fit results always plot with the post-fit value of <code>r</code>.</li>
<li><b>plotTitles</b> (<code>bool</code>, default=<code>true</code>): By default, plot titles are always included in the plotting (this is useful for determining the boundaries of slices that are projected onto the opposite axis). Set to <code>false</code> this option turns off plot titles so that they are more appropriate for publication.</li>
<li><b>addSignals</b> (<code>bool</code>, default=<code>true</code>): By default, this option adds the signals for the sake of plotting so that they are considered as "one signal" in the legend and plots. This is useful if you have defined a separate signal for each year in a Run II configuration file. When set to <code>false</code>, the plotting will consider the signals as separate and they will be drawn separately and with different legend entries. This is useful if you have multiple unique signals.</li>
</ul>
<p>The following are "developer/advanced options" that would mainly be useful for anyone working on the 2D Alphabet code or debugging a fit.</p>
<ul>
<li><b>draw</b> (`bool', default=<code>false</code>): This will live draw plots as they are created (sets <code>gROOT.SetBatch(kTRUE)</code>). Useful if one has pauses in the code to view the plots. Since 2D Alphabet most likely is running remotely, this will be very slow!</li>
<li><b>verbosity</b> (`int', default=<code>0</code>): Sets Combine verbosity. Setting in the first of the provided configuration files will determine behavior of the group run.</li>
<li><b>fitGuesses</b> ('dict<code>, default=</code>None`): Not recommended for use since it has gone untested for quite some time. This is because it is largely unnecessary and will most likely be removed. For the sake of documentation, the option creates slices along <code>Y</code> and projects them onto <code>X</code> to perform 1D fits in the slices. The parameters of the 1D fits are then fit as a function of <code>Y</code> to determine the <code>Y</code> dependence. The output of this pseudo-2D fit is then fed into the true 2D fit with Combine as a better pre-fit starting point.</li>
<li><b>overwrite</b> (<code>bool</code>, default=<code>false</code>): Explicitly deletes the configuration file's corresponding sub-folder in the project directory before running. This is usually not necessary unless you've done something such as remove a MC-based background from the model without changing the tag. The plots of that process from the previous run would remain since no new plots would be made to replace them.</li>
<li><b>recycle</b> - (<code>[string]</code>, default=<code>[]</code>): Not recommended for use since the introduction of the <code>--recycleAll</code> option of <code>run_MLfit.py</code>. Recycles named pieces of saveOut.p. Available pieces are "name", "tag", "xVarName", "yVarName", "xVarTitle", "yVarTitle", "sigStart", "sigEnd", "freezeFail", "blindedFit", "blindedPlots", "newXbins", "full_x_bins", "newYbins", "rpf", "rpfVarNames", "organizedDict", "floatingBins". I cannot think of a good use for this option that would not also be dangerous or overcome by just re-running!</li>
</ul>
<h2><a class="anchor" id="config-process"></a>
`PROCESS`</h2>
<p>In this section, the user can define as many processes as they need. This includes data, background simulation, and signal simulation. Please note two important things:</p><ol type="1">
<li>You should NOT define the non-resonant background that is meant to be estimated from data ("multijet"). That background is naturally defined by the difference between data and the other backgrounds defined here.</li>
<li>Combine always requires that there be an observation (data), a background estimate, and a signal sample. This means that your configuration file must contain data (code 1) and signal (code 0). The codes classify the processes and are defined below.</li>
</ol>
<p>Each key in <code>PROCESS</code> is the name of each process of interest. Please name your data as <code>data_obs</code>. This is a Combine convention that 2D Alphabet maintains. Each process name is a key for a sub-dictionary that specifies</p><ul>
<li><code>"TITLE":</code></li>
<li><code>"FILE":</code> the path to the file containing the nominal pass and fail histograms for the process (string);</li>
<li><code>"HISTPASS":</code> the name of the histogram in the above file with the passing distribution (string);</li>
<li><code>"HISTFAIL":</code> the name of the histogram in the above file with the failing distribution (string);</li>
<li><code>"SYSTEMATICS":</code> a list of strings that correspond to the names of systematics in <code>SYSTEMATIC</code> (note <code>SYSTEMATIC</code> not <code>SYSTEMATICS</code>) that are applicable to this process (list of strings);</li>
<li><code>"CODE":</code> a way to classify the treatment of the process: 0 (signal), 1 (data), 2 (background simulation)</li>
</ul>
<p>Here is an example PROCESS dictionary section:</p>
<div class="fragment"><div class="line">&quot;PROCESS&quot;: {</div><div class="line">    &quot;data_obs&quot;: {</div><div class="line">        &quot;FILE&quot;: &quot;data_tau32medium_default.root&quot;,</div><div class="line">        &quot;HISTPASS&quot;: &quot;MtwvMtPass&quot;,</div><div class="line">        &quot;HISTFAIL&quot;: &quot;MtwvMtFail&quot;,</div><div class="line">        &quot;SYSTEMATICS&quot;:[],</div><div class="line">        &quot;CODE&quot;: 1</div><div class="line">    },</div><div class="line">    &quot;ttbar&quot;: {</div><div class="line">        &quot;TITLE&quot;:&quot;t#bar{t}&quot;,</div><div class="line">        &quot;FILE&quot;:&quot;ttbar_tau32medium_default.root&quot;,</div><div class="line">        &quot;HISTPASS&quot;:&quot;MtwvMtPass&quot;,</div><div class="line">        &quot;HISTFAIL&quot;:&quot;MtwvMtFail&quot;,</div><div class="line">        &quot;SYSTEMATICS&quot;:[&quot;syst1&quot;,&quot;syst2&quot;,&quot;syst3&quot;,&quot;syst4&quot;],</div><div class="line">        &quot;COLOR&quot;: 2,</div><div class="line">        &quot;CODE&quot;: 2</div><div class="line">    },</div><div class="line">    &quot;signalLH2400&quot;: {</div><div class="line">        &quot;TITLE&quot;:&quot;b*_{LH} (2.4 TeV)&quot;,</div><div class="line">        &quot;FILE&quot;: &quot;signalLH2400_tau32medium_default.root&quot;,</div><div class="line">        &quot;HISTPASS&quot;: &quot;MtwvMtPass&quot;,</div><div class="line">        &quot;HISTFAIL&quot;: &quot;MtwvMtFail&quot;,</div><div class="line">        &quot;SYSTEMATICS&quot;:[&quot;syst1&quot;,&quot;syst3&quot;,&quot;syst5&quot;,&quot;jmr17&quot;,&quot;jms17&quot;],</div><div class="line">        &quot;CODE&quot;: 0,</div><div class="line">        &quot;COLOR&quot;: 0</div><div class="line">    }</div></div><!-- fragment --><h2><a class="anchor" id="config-binning"></a>
`BINNING`</h2>
<p>This dictionary is the opportunity to define the axis binning of the user's space. The binning values are split into x and y axis definitions where the x-axis describes the variable whose signal region is blinded. Note that 2D Alphabet can rebin and reduce the ranges of the input axes for you. The binning in each axis cannot be beyond the range of the input histogram (hopefully, this is obvious) but it can be a subset of the input range. The number of bins are restricted to be equal to or less than the input number of bins (hopefully, this is also obvious). Additionally, any newly defined bin edges must line up with input bin edges (ie. there's no bin splitting).</p>
<p>The signal bounds only apply to the <code>X</code> axis and must exist within the <code>X</code> axis range defined in the configuration file so that there are always three regions defined with non-zero width. Only the signal region will be blinded during the fitting and plotting. The options to perform this blinding are described in the [<code>OPTIONS</code> section](OPTIONS).</p>
<p>For either axis, there are two options for binning: constant width and variable width. To use variable bins, provided a list of bin edges to the <code>BINS</code> key. To have 2D Alphabet calculate the bin edges with constant bin width, use the <code>MIN</code>, <code>MAX</code>, and <code>NBINS</code> keys (as you would in a <code>TH1</code> definition).</p>
<p>An example formatting of the <code>BINNING</code> section is provided here.</p>
<p>```json "X": "NAME": &lt;name of="" internal="" variable="" on="" the="" x-axis&gt;=""&gt;, # string "TITLE": &lt;title to="" appear="" in="" plots="" with="" this="" axis&gt;=""&gt;, # string "MIN": &lt;lower bound="" of="" x-axis&gt;=""&gt;, # float "MAX": &lt;upper bound="" of="" x-axis&gt;=""&gt;, # float "NBINS": &lt;number of="" x="" bins="" from="" min="" to="" max&gt;=""&gt;, # int "SIGSTART": &lt;lower bound="" of="" signal="" region="" of="" x-axis&gt;=""&gt;, # int "SIGEND": &lt;upper bound="" of="" signal="" region="" of="" x-axis&gt;=""&gt; # int "Y"` "NAME": name of your variable on the y-axis, # string "TITLE": title that you'd like to appear in plots with this axis, # string "BINS": [&lt;edge1&gt;, &lt;edge2&gt;,...&lt;edgeN&gt;] # [float] </p><div class="fragment"><div class="line">Because the `X` axis is split into three portions (`LOW`, `SIG`, `HIGH`), one can also</div><div class="line">define binning per region of the `X` axis. `BINS` can be used as well as `MIN`, `MAX`, `NBINS` like so:</div><div class="line"></div><div class="line">```json</div><div class="line">&quot;X&quot;:</div><div class="line">    &quot;NAME&quot;: &lt;name of internal variable on the x-axis&gt;, # string</div><div class="line">    &quot;TITLE&quot;: &lt;title to appear in plots with this axis&gt;, # string</div><div class="line">    &quot;LOW&quot;: {</div><div class="line">        &quot;MIN&quot;: &lt;lower bound of x-axis&gt;, # float</div><div class="line">        &quot;MAX&quot;: &lt;upper bound of x-axis&gt;, # float</div><div class="line">        &quot;NBINS&quot;: &lt;number of x bins from MIN to MAX&gt; # int</div><div class="line">    }</div><div class="line">    &quot;SIG&quot;: {</div><div class="line">        &quot;MIN&quot;: &lt;lower bound of x-axis&gt;, # float</div><div class="line">        &quot;MAX&quot;: &lt;upper bound of x-axis&gt;, # float</div><div class="line">        &quot;NBINS&quot;: &lt;number of x bins from MIN to MAX&gt; # int</div><div class="line">    }</div><div class="line">    &quot;HIGH&quot;: {</div><div class="line">        &quot;MIN&quot;: &lt;lower bound of x-axis&gt;, # float</div><div class="line">        &quot;MAX&quot;: &lt;upper bound of x-axis&gt;, # float</div><div class="line">        &quot;NBINS&quot;: &lt;number of x bins from MIN to MAX&gt; # int</div><div class="line">    }</div><div class="line">    &quot;SIGSTART&quot;: &lt;lower bound of signal region of x-axis&gt;, # int</div><div class="line">    &quot;SIGEND&quot;: &lt;upper bound of signal region of x-axis&gt; # int</div></div><!-- fragment --><h2><a class="anchor" id="config-fit"></a>
`FIT`</h2>
<p>This section defines the values of the fit parameters for the transfer function from the fail region to the passing (or pass-fail ratio). The 2D fit can accommodate any functional form. Each parameter in equation should be marked with a @ symbol (RooFit convention) starting at 0. Each parameter should also be specified with range and if desired an error (which does not establish a constraint but just an initial step size in the minimization).</p>
<p>An example section which uses a polynomial in both directions (of different orders) is provided below. The range of each parameter is -10 to 10 with a starting (<code>NOMINAL</code>) value of 1.0 and step size (<code>ERROR</code>) of 0.1.</p>
<p>To accommodate for the potential of a negative transfer function value in all or part of the 2D space (which would be unphysical and make Combine very mad), the <code>FORM</code> provided is wrapped in <code>max(FORM, 1e-9)</code>. Thus, one should always check in the plots that the final parameters do not produce a ~0 transfer function in large portions of the space. The fit result will not be stable. This can be addressed by reducing the ranges (<code>MIN</code>/<code>MAX</code>) of the parameters or changing the functional form.</p>
<div class="fragment"><div class="line">&quot;FIT&quot;: {</div><div class="line">    &quot;FORM&quot;:&quot;(@0+@1*x**1+@2*x**2)*(1+@3*y)&quot;,</div><div class="line">    &quot;0&quot;: {</div><div class="line">        &quot;NOMINAL&quot;: 1.0,</div><div class="line">        &quot;MIN&quot;:-10.0,</div><div class="line">        &quot;MAX&quot;:10.0,</div><div class="line">        &quot;ERROR&quot;:0.1</div><div class="line">    },</div><div class="line">    &quot;1&quot;: {</div><div class="line">        &quot;NOMINAL&quot;: 1.0,</div><div class="line">        &quot;MIN&quot;:-10.0,</div><div class="line">        &quot;MAX&quot;:10.0,</div><div class="line">        &quot;ERROR&quot;:0.1</div><div class="line">    },</div><div class="line">    &quot;2&quot;: {</div><div class="line">        &quot;NOMINAL&quot;: 1.0,</div><div class="line">        &quot;MIN&quot;:-10.0,</div><div class="line">        &quot;MAX&quot;:10.0,</div><div class="line">        &quot;ERROR&quot;:0.1</div><div class="line">    },</div><div class="line">    &quot;3&quot;: {</div><div class="line">        &quot;NOMINAL&quot;: 1.0,</div><div class="line">        &quot;MIN&quot;:-10.0,</div><div class="line">        &quot;MAX&quot;:10.0,</div><div class="line">        &quot;ERROR&quot;:0.1</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="config-syst"></a>
`SYSTEMATIC`</h2>
<p>Because it bears repeating, please note the difference between this section, <code>SYSTEMATIC</code>, and the list of <code>SYSTEMATICS</code> defined inside the <code>PROCESS</code> dictionary. The <code>SYSTEMATIC</code> dictionary is a place to define as many systematics as a user may need. Similar to the processes, each key in <code>SYSTEMATIC</code> is the name of the systematic in the analysis and each is classified by a code that determines how the systematic will be treated. However, the dictionary the user defines for a given systematic is different depending on what type it is. The self-explanatory codes are 1 and 2 which are log-normal uncertainties on the normalization. Less obvious are codes 2 and 3 which are for shape based uncertainties (and thus have corresponding histograms) and are either in the same file as the process's nominal histogram (code 2) or in a separate file (code 3). Additionally, they have a scale value which allows the user to change the Gaussian constraint on the shape. For no change in the constraint, use 1.0. If you have templates representing a 2 $$$$ shift, use 0.5 to properly constrain the associated nuisance parameter during the shape interpolation with Combine.</p>
<p>### Symmetric, log-normal {#config-syst-sym} </p><div class="fragment"><div class="line">&quot;CODE&quot;: 0,</div><div class="line">&quot;VAL&quot;: &lt;uncertainty&gt; # float</div></div><!-- fragment --><h3><a class="anchor" id="config-syst-asym"></a>
Asymmetric, log-normal</h3>
<div class="fragment"><div class="line">&quot;CODE&quot;: 1,</div><div class="line">&quot;VALUP&quot;: &lt;+1 $$\sigma$$ uncertainty&gt;, # float</div><div class="line">&quot;VALDOWN&quot;: &lt;-1 $$\sigma$$ uncertainty&gt; # float</div></div><!-- fragment --><p>### Shape based uncertainty, in same file as nominal histogram {#config-syst-shape1} </p><div class="fragment"><div class="line">&quot;CODE: 2&quot;,</div><div class="line">&quot;HISTPASS_UP&quot;: &lt;name of hist (in same file as nominal hist) for +1 sig uncertainty in pass distribution&gt;, # string</div><div class="line">&quot;HISTPASS_DOWN&quot;: &lt;name of hist (in same file as nominal hist) for -1 sig uncertainty in pass distribution&gt;, # string</div><div class="line">&quot;HISTFAIL_UP&quot;: &lt;name of hist (in same file as nominal hist) for +1 sig uncertainty in fail distribution&gt;, # string</div><div class="line">&quot;HISTFAIL_DOWN&quot;: &lt;name of the hist (in same file as nominal hist) for -1 sig uncertainty in fail distribution&gt;, # string</div><div class="line">&quot;SCALE&quot;: &lt;scale value to change scale of nuisance constraint&gt; # float</div></div><!-- fragment --><h3><a class="anchor" id="config-syst-shape2"></a>
Shape based uncertainty, in different file as nominal histogram</h3>
<p>This is the more flexible but also more complicated option. The user can specify files three different ways.</p>
<ol type="1">
<li>By using <code>FILEUP</code> and <code>FILEDOWN</code> to pick a file that <em>every</em> process can pull the shape uncertainty histograms from.</li>
<li>Use keys of the form <code>FILEUP_&lt;proc&gt;</code> where <code>&lt;proc&gt;</code> matches the name of a process that is defined in the <code>PROCESS</code> dictionary and has this shape uncertainty associated with it. This allows each systematic and process to come from a separate file.</li>
<li>Use keys of the form <code>FILEUP_*</code> where the * acts as a wild card for the process and must also exist in the file name where the process would normally be written. For example, if a $$t{t}$$ distribution with +1 $$$$ pileup uncertainty is stored in <code>ttbar_pileup_up.root</code> and the corresponding signal distributions are in <code>signal_pileup_up.root</code>, one can use the key-value pair <code>"FILE_UP_*":"*_pileup_up.root"</code>.</li>
</ol>
<p>The user can also specify histogram names in four different ways.</p><ol type="1">
<li><code>HISTPASS</code> and <code>HISTFAIL</code> which allows the user to specify only two histogram names if they don't change between "up" and "down" shapes.</li>
<li>The second is if the "up" and "down" shapes <em>do</em> have different histogram names and uses the form <code>HISTPASS_UP</code> <code>HISTFAIL_UP</code>.</li>
<li>The totally generic way allows the user to use the form <code>HISTPASS_UP_&lt;proc&gt;</code> where <code>&lt;proc&gt;</code> matches the name of a process that is defined in the <code>PROCESS</code> dictionary and has this shape uncertainty associated with it.</li>
<li>The "*" wildcard can be used in place of <code>&lt;proc&gt;</code> just as with the file keys.</li>
</ol>
<p>Below is an example of the totally generic way (3).</p>
<div class="fragment"><div class="line">&quot;CODE&quot;: 3,</div><div class="line">&quot;FILEUP_&lt;proc&gt;&quot;: &lt;/path/to/fileup_&lt;proc&gt;_up.root&gt;, # string</div><div class="line">&quot;FILEDOWN_&lt;proc&gt;&quot;: &lt;/path/to/filedown_&lt;proc&gt;_down.root&gt;, # string</div><div class="line">&quot;HISTPASS_UP&quot;: &lt;name of hist (in same file as nominal hist) for +1 sig uncertainty in pass distribution&gt;, # string</div><div class="line">&quot;HISTPASS_DOWN&quot;: &lt;name of hist (in same file as nominal hist) for -1 sig uncertainty in pass distribution&gt;, # string</div><div class="line">&quot;HISTFAIL_UP&quot;: &lt;name of hist (in same file as nominal hist) for +1 sig uncertainty in fail distribution&gt;, # string</div><div class="line">&quot;HISTFAIL_DOWN&quot;: &lt;name of the hist (in same file as nominal hist) for -1 sig uncertainty in fail distribution&gt;, # string</div><div class="line">&quot;SCALE&quot;: &lt;scale value to change scale of nuisance constraint&gt; # float</div></div><!-- fragment --><p>The various options lead to flexibility but the more organized you are, the easier it is to write the configuration file!</p>
<h1><a class="anchor" id="python"></a>
Python Interface</h1>
<h2><a class="anchor" id="python-twoD"></a>
Constructing TwoDAlphabet</h2>
<h2><a class="anchor" id="python-parametric"></a>
Defining Parametric Shapes</h2>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
